<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>图书管理-用户管理</title>
  <script src="../jQuery/jquery-3.5.1.slim.min.js"></script>
  <script src="../jQuery/jquery-3.5.1.min.js"></script>
  <link rel = "stylesheet" href = "../jQueryUI-1.13.2/jquery-ui.min.css">
  <link rel = "stylesheet" href = "../jQueryUI-1.13.2/jquery-ui.structure.min.css">
  <link rel = "stylesheet" href = "../jQueryUI-1.13.2/jquery-ui.theme.min.css">
  <script src="../jQueryUI-1.13.2/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="../css/common.css">
</head>
<body>
<div id="choList">
  <input type="button" class="ui-button" id="back" style="display: none" value="返回">
</div>
<div>
  <table>
    <thead>
    <tr>
      <td>用户ID</td>
      <td>用户名</td>
      <td>昵称</td>
      <td>权限等级</td>
      <td>最大借阅数</td>
      <td rowspan="2">操作</td>
    </tr>
    </thead>
    <tbody id="showUser">
    </tbody>
  </table>
</div>
<div id="resetInfo" style="display: none;position: fixed;top:25%;left: 20%;height: 40%;width: 60%;border: 1px solid #000;background-color: #cccccc">
<!--  暂时没用上-->
</div>
</body>
<script>
  $(document).ready(function(){
    $.ajax({
      url: "../user/listAllUser",
      type: "post",
      data: {},
      async: false,
      success:function (data) {
        console.log(data);
        var $show = $("#showUser").empty();
        for(let i = 0; i < data.length; i++) {
          var statusStr = "无权限";
          switch (data[i].status){
            case '0':
              statusStr = "系统管理员";
              break;
            case '1':
              statusStr = "专家";
              break;
            case '2':
              statusStr = "借阅者";
              break;
            default:
              break;
          }
          var temp = $("<tr>" +
                  "<td id='userid'>" + data[i].userid + "</td>" +
                  "<td>" + data[i].username + "</td>" +
                  "<td class='resetNickname'>" + data[i].nickname + "</td>" +
                  "<td class='resetStatus'>" + data[i].statusStr + "</td>" +
                  "<td class='resetMaxlend'>" + data[i].maxlend + "</td>" +
                  "<td class='resetPassword'>重置密码</td>" +
                  "<td class='deleteUser'>删除用户</td>" +
                  "</tr>");
          $sele.append(temp);
        }
      },
      error: function(error){
        console.log(error);
      }
    });

    $("#back").on('click', function(){
      location.href="../home.html";
    });
    $(".resetNickname").on('click', (e)=>{
      var userid = $(this).parent().find("userid").html();
      var newInfo = prompt("要更新为：", "new Info");
      if(newInfo != null && newInfo !== ""){
        $.ajax({
          url : "../user/resetNickname",
          type: "post",
          data: {
            userid: Number(userid),
            nickname: newInfo
          },
          dataType: "json",
          async: false,
          success: function(data){
            alset("更新成功！");
            location.reload();
          },
          error: function(error){
            alset("更新出错！");
          }
        });
      }
    });
    $(".resetStatus").on('click', (e)=>{
      var userid = $(this).parent().find("userid").html();
      var newInfo = prompt("要更新为：", "new Info");
      if(newInfo != null && newInfo !== "" && Number(newInfo) >=0 && Number(newInfo) <= 2){
        $.ajax({
          url : "../user/resetStatus",
          type: "post",
          data: {
            userid: Number(userid),
            status: Number(newInfo)
          },
          dataType: "json",
          async: false,
          success: function(data){
            alset("更新成功！");
            location.reload();
          },
          error: function(error){
            alset("更新出错！");
          }
        });
      }
    });
    $(".resetMaxlend").on('click', (e)=>{
      var userid = $(this).parent().find("userid").html();
      var newInfo = prompt("要更新为：", "new Info");
      if(newInfo != null && newInfo !== "" && (Number(newInfo)) !== "NaN"){
        $.ajax({
          url : "../user/resetMaxlend",
          type: "post",
          data: {
            userid: Number(userid),
            maxlend: Number(newInfo)
          },
          dataType: "json",
          async: false,
          success: function(data){
            alset("更新成功！");
            location.reload();
          },
          error: function(error){
            alset("更新出错！");
          }
        });
      }
    });
    $("#resetPassword").on('click', (e)=>{
      var userid = $(this).parent().find("#userid").html();
      $.ajax({
        url: "../user/resetPassword",
        type: "post",
        data: {
          userid: Number(userid)
        },
        dataType: "json",
        async: false,
        success: function(data){
          alert("重置密码成功！");
          console.log(data);
        },
        error: function(e){
          console.log(e);
        }
      });
    });
    $("#deleteUser").on('click', (e)=>{
      var userid = $(this).parent().find("#userid").html();
      $.ajax({
        url: "../user/deleteUser",
        type: "post",
        data: {
          userid: Number(userid)
        },
        dataType: "post",
        async: false,
        success: function(data){
          alert("删除用户账号成功！");
          console.log(data);
        },
        error: function(e){
          console.log(e);
        }
      });
    });
  });
</script>
</html>