<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>图书推荐系统-猜你喜欢</title>
    <script src="./jQuery/jquery-3.5.1.slim.min.js"></script>
    <script src="./jQuery/jquery-3.5.1.min.js"></script>
    <link rel = "stylesheet" href = "./jQueryUI-1.13.2/jquery-ui.min.css">
    <link rel = "stylesheet" href = "./jQueryUI-1.13.2/jquery-ui.structure.min.css">
    <link rel = "stylesheet" href = "./jQueryUI-1.13.2/jquery-ui.theme.min.css">
    <script src="./jQueryUI-1.13.2/jquery-ui.min.js"></script>
</head>
<body>
<div id="root" style="width: 100%;height: auto;position: relative;overflow-y: scroll">
    <input type="button" class="ui-button" id="tologgout" value="退出登录">
    <input disabled type="button" class="ui-button" id="loginUser" value="">
    <input type="button" class="ui-button" id="search" value="搜索图书">
    <input type="button" class="ui-button" id="extro" value="专家推荐">
    <input type="button" class="ui-button" id="newBook" value="新书推荐">
    <div id="showContent" style="left: 0;width: 50%;height: auto;position: relative;overflow-y: scroll">

    </div>
    <div id="newContent" style="right: 0;width: 50%;height: auto;position: relative;overflow-y: scroll">

    </div>
</div>
<script>
    $(document).ready(function(){
        var pthis = $(document).find("#showContent");
        pthis.append("<input id='fresh' type='button' class='ui-button' value='刷新推荐'>");
        $("#loginUser").val(localStorage.getItem("loginUser"));
        $.ajax({
            url: "/books/getBooksByHistory",
            type: "get",
            data: {
                userid: localStorage.getItem("userid")
            },
            dataType: "json",
            async: false,
            success: function(data){
                var pthis = $(document).find("#showContent");
                for(var i = 0; i < data.length; i++){
                    var oneDiv = $("<div></div>");
                    oneDiv.append("<input disabled type='text' id='book_" + data[i].bookid +"' value='" + data[i].bookname + "'>" +
                        "<input disabled type='text' value='" + data[i].booktype + "'>" +
                        "<input disabled type='text' value='热度:" + data[i].lendnum + "'>" +
                        "<input disabled type='text' value='剩余数量:" + data[i].remainnum + "'><br>" +
                        "<img alt='图书封面' src='" + data[i].image + "'><br>" +
                        "<input disabled type='text' value='" + data[i].intro + "'><br>");
                    pthis.append(oneDiv);
                }
            },
            error: function(e){
                console.log(e);
            }
        });
        var pinfo = $(document).find("#newContent");
        pinfo.append("<input disabled type='button' class='ui-button' value='通知'>");
        $.ajax({
            url: "/info/getInfoListForUser",
            type: "get",
            data: {
                userid: localStorage.getItem("userid")
            },
            dataType: "json",
            async: false,
            success: function(data){
                var pthis = $(document).find("#showContent");
                for(var i = 0; i < data.length; i++){
                    var oneDiv = $("<div></div>");
                    oneDiv.append("时间:<input type='datetime' disabled value='" + data[i].infotime+ "'>" +
                        "新书:<input disabled type='text' value='" + data[i].bookname + "'>" +
                        "分类:<input disabled type='text' value='" + data[i].booktype + "'>" +
                        "<textarea id='info_" + data[i].infoid + "' disabled " +
                        "style='width:100%;height: 75px;resize: none;overflow-y: scroll'>"
                        + data[i].infocontent +"</textarea>" +
                        "简介:<input disabled type='text' value='" + data[i].intro + "'>");
                    pthis.append(oneDiv);
                }
            },
            error: function(e){
                console.log(e);
            }
        });
    });
    $(document).on('click', '#tologgout', function () {
        $.ajax({
            url: "user/logout",
            type: "post",
            data: {},
            dataType: "json",
            async: false,
            success: function(data){
                localStorage.setItem("loginUser", "");
                localStorage.setItem("userid", "");
                localStorage.setItem("status", "");
                alert("退出登录成功！");
            },
            error: function (error) {}
        });
        location.reload();
    });
    $(document).on('click', '#fresh', function(){
        location.reload();
    });
    $("#extro").on('click', function(){
        location.href="extro.html"
    });
    $("#search").on('click', function(){
        location.href="search.html";
    });
</script>
</body>
</html>